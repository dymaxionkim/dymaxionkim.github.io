# BOM

## 아이디어 (컨셉)
* 기존의 PDM/PLM 시스템은, 사용자의 CAD 시스템에 플러그인을 개발해서 억지로 붙여놓고, 데이타를 강제로 갱신시켜가면서 운용하고, 또 한국 기업 실무에 맞는 기능들 대신 별 쓸데없는 기능들이 붙어있는 식이 많다.
* CAD 시스템에 종속시키지 말고, 철저하게 STEP 파일을 통해 데이타 교환을 실시하고, 이에 기반하여 모든 데이타를 관리하도록 한다.
* 사용자가 BOM 데이타를 생성할 때 직접 작성하지 말고, STEP 파일을 업로드시키면 곧바로 자동 생성되도록 한다.

## 접근 방법
* STEP AP203 기준. (호환성, 단순성)
* STEP 파일을 읽어들이고, 내용을 자동 분석.
* 읽어들이는 원시 AP203 파일에는 제대로 된 Attribute 정보가 포함되어 있지 않은 경우가 대부분이므로, PartName 및 형상정보 이외의 모든 정보는 무시한다.
* BOM Tree, PartList 자동 생성.  BOM에는 각 Part의 위치/자세 좌표 정보도 함께 자동으로 기록한다.
* DB에 이미 존재하는 Part Name과 중복될 경우, Alternative로 취급하거나 Revision을 올려준다.
* 읽어들인 STEP 파일 내의 Product들을 전부 분해해서 각각의 Part 파일로 자동 저장한다.
* 각 Part들에 필요한 Attribute는 사용자가 직접 입력할 수 있도록 한다.
* PartNumber는 ParName으로부터 자동 생성되도록 한다.  이후 수동으로 수정 가능하도록 한다.
* Made/Bought 구분 역시 ParNumber로부터 자동 구분되도록 한다.  이후 PartNumber가 바뀔 때 자동 갱신한다.
* 분해되어 별도 파일들로 저장된 부품들을 조합하여 다시 전체 어셈블리 STEP 파일을 생성한다. 사용자는 이후 이 파일을 받아서 볼 수 있도록 한다.
* 2D 도면은 사용자가 PartName과 동일한 FileName으로 생성한 PDF,DWG 파일을 일괄 업로드 하도록 한다.  일괄 업로드 한 후, 각각의 Part 구조체에 자동으로 링크시킨다.
* 도면이 매칭되지 않거나, 업로드 되지 않은 부품에 대해서는 사용자에게 알려준다.

## Analyzing STEP
* [STEP Explorer](http://www.johannes-raida.de/projects.htm)
* [STEP Express Schema Protocol](http://www.steptools.com/support/stdev_docs/express/)
* [Wiki STEP](http://www.wikistep.org/index.php/Main_Page)
* [OpenPLM](http://wiki.openplm.org/trac)
* [ISO10303 Wikipedia](https://en.wikipedia.org/wiki/ISO_10303)
* [Online STEP file Viewer](http://step3d.com/)
* [STEP file Analyzer](http://www.nist.gov/el/msid/infotest/step-file-analyzer.cfm)

## 예상되는 잇점
* AP203 만을 대상으로 개발하면, 다른 프로토콜을 고려할 필요가 없으므로 개발 규모를 크게 줄일 수 있다.  또 STEP203은 text 포멧 파일이므로, 다루기가 매우 용이하다.
* PartNumber를 자동으로 채번해 주므로, 실무자의 업무량을 크게 줄여줄 수 있다.
* Made/Bought 정보를 자동으로 결정해 주므로, 실무자의 업무량을 크게 줄여줄 수 있다.
* PartNumber, Made/Bought 정보가 자동 생성되더라도, 특수한 경우에는 사용자가 수동으로 수정할 수 있도록 해 줘서 크로스체크할 수 있다.
* A 제품 어셈블리를 먼저 올려두고, 이후에 B 제품 어셈블리를 올렸을 경우, 두 제품에 모두 사용되는 공용부품이 존재할 확률이 높다.  이 경우, 동일 PartName을 가지고 있는지 여부만 가지고 간단히 판단하도록 하여 Logic의 복잡도를 줄인다.  동일 부품으로 판단하였을 경우, Alternative 또는 New Revision으로 할지, 또는 기존 데이타를 그대로 사용할지 여부를 사용자가 결정하도록 할 수 있을 것이다.
* X3D WebGL 웹서비스 형태로 필요한 Viewer 구성이 용이하다.
* 스스로 깨끗하게 정리된 Attribute 정보가 포함된 STEP 파일을 재구성해 낼 수 있다면, 추후의 데이타 마이그레이션이 더욱 용이해질 것이다.
* 사용자는 자신이 엑셀로 직접 BOM, PartList를 작성 작업할 필요가 없다.  때문에 업무량을 크게 줄일 수 있을 것이다.

## 사용 시나리오
### 설계단계 (준비)
* 설계자가 제품 설계를 한다.  CATIA든 CREO든 뭐든 간에 상관없다.
* 설계 완료후, 전체 어셈블리의 Tree 구조를 정돈한다.  그리고 STEP 파일로 저장한다.
* 2D 도면 작업도 한다.  도면은 각 PartName과 동일한 명칭의 FileName을 가지도록 저장한다.  포멧을 DWG, PDF 두가지로 병행 저장한다.
### PDM 입력단계 (작업)
* STEP 파일을 업로드 한다.
* 2D 도면도 일괄 업로드 한다.
* 피드백되어 나오는 메시지에 따라 보완 작업을 해 준다. (누락된 2D 도면 보충 업로드, 명칭 안맞는 것들에 대한 수정, 각 Part의 Attribute 검토 및 오류 수동 수정 작업, Description/Contractor/Price 등의 추가정보 입력)
### PDM 자동 마이그레이션 단계 (자동)
* 사용자의 완료 명령에 내려지면, 정보를 스스로 갱신한다.  DB에 저장하고, STEP 파일을 분해해서 각 파트 구조체에 저장하고, 전체 어셈블리 STEP 파일도 재생성한다.
### PDM 공표단계 (승인)
* 설계안에 대한 승인권자가 OK 버튼을 눌러 승인한다. 그러면 시스템 내 지정 그룹 사용자들에게 정보가 공개된다.

## 부가기능 (검토)
* 3D Viewer : 모든 STEP 파일은 자동으로 X3D WebGL 파일로 변환한다. X3D WebGL 파일은 JavaScript 기반의 WebViwer로 열람 가능하도록 지원한다.  Viewer의 기능이 강력하다면, Explode 및 Rendering 기능까지 기대해 볼 수 있을 것이다.  OpenSource Code들도 충분히 쓸만하다.  상용 Code를 장착한다면 더 강력하고 깔끔한 품질을 얻을 수 있다.
* PDF Merge : BOM 또는 PartList에서 필요한 부품들을 골라서 하나의 PDF 파일로 Merge 해서 다운로드 할 수 있게 해 주면 더 편리할 것이다.
* Web DWG Viewer : OpenSource Code 중에는 쓸 수 있는게 없다.  상용 Code를 붙여서는 구현 가능하다.
* ECR/ECO 자동 생성 : 각 부품의 Revision이 갱신될 때 마다, 적절하게 해당 양식을 자동으로 생성하도록 한다.  Excel이나 HTML,PDF 같은 형태를 취할 수 있을 것이다.
* Electronics : PCB 회로도면, 거버파일, BOM, 파트리스트를 기구부품과 동일한 방식으로 다루도록 한다.
* SoftWare : 별도로 버전관리 기능을 개발할 필요없이, 서브버전 또는 Git 서버와 연결해 주기만 하면 될 것이다.

## 예상되는 문제점과 해결책
* STEP 파일의 Express Schema를 파싱하는 것은 꽤 어려운 기술이다.  Schema가 국제표준으로 공개되어 있다고 해서, 그 구현체가 아무데나 막 굴러다니고 있지는 못한 상황이다.
* 현재 상황을 간단히 서머리 해 보자면...  STEP 파일 관련해서 제대로 구현된 곳들은 모두 상용 소프트웨어 업체들 뿐이다.  거의 유일하게 쓸만한 오픈소스 솔루션은 Open Cascade 프로임웤 뿐이다.
* Open Cascade가 비록 기능적으로 훌륭하다고는 하지만, 이걸 이용해서 필요한 어플리케이션을 개발하는 것은 또 다른 문제다.  PythonOCC로 비교적 신속하게 개발이 가능하다고는 하지만, 국내 개발자들 현실을 보면 파이썬으로 프로페셔널한 수준까지 개발하는 사람이 얼마나 될 지 모르겠다.  물론 실력자들이야 많겠지만 그들은 자신의 주업무나 관심사가 다르기 때문에.
* OpenPLM에서는 PythonOCC를 가지고 STEP 파일을 분해해 주는 Decompose 기능의 코드까지 모두 다 구현해 놓았다.  너무나 환상적이다.  소스 분석이 어려운 것 같지는 않다.  (일단 소스의 분량이 매우 적다)  아무튼 파이썬을 다루는 사람으로, 기계공학 분야의 3D 기술에 관심이 있거나 전문성이 있는 개발자를 구할 수 있다면 환상적이겠다.
* 그런데 그런 개발자를 구할 수 없다면 대안은 없을까?
* 웹개발자들은 비교적 많으므로, 3D 데이타 관련 부분만 해결해 주면 되지 않을까.  이 부분은 PythonOCC보다 더 편하게 그냥 갖다 붙여서 쓸 수 있는 솔루션이 있다면 좋을텐데.  좀 찾아보니 상용으로 여러가지 존재하기는 한다.
* 특히 주목되는 것은 CADEX라는 업체이다.  http://cadexchanger.com/
* Open Cascade 기반으로 기업에서 커스텀화해서 응용하기 좋도록 툴을 만들어서 제공한다.  GUI 버전을 받아서 사용해 보니 완성도가 꽤 좋다.  서버측 서비스용으로 그냥 갖다 쓸 수 있도록 CLI 실행파일 솔루션도 만들어놓고 제공해 주나 보다.  좀 더 다루고 싶은 개발자를 위해서는 SDK로도 제공한다.  필요 기능의 수준에 따라 선택하면 될 것 같다.  가격은 높게 받지는 않을 것 같은데, 기회가 되면 한 번 접촉해서 알아볼 만 한 것 같다.
* 이 솔루션을 가져다 쓰게 되면, STEP 파일 분석에 들어가는 공수를 거의 없애버리고, STEP 파일에서 직접 X3D 파일을 만들어내거나, Product Structure Tree를 뽑아내거나 하는 드으이 일들을 간단히 구현 가능하다.  STEP 파일을 분해해서 각각의 파트들로 나누어 저장하고, 그것을 재조합하는 것도 SDK 수준에서는 가능할 것 같다 (너무 과한 욕심인가).
* 오픈소스 쪽에서는 FreeCAD 뿐인데, 여기서는 아직 STEP 파일 분석 가능이 덜 구현되어 있다.  STEP 파일을 불러들이면 Product Structure가 붕괴되어 나타난다. (멀티레벨로 안 나오고 1단계로 Flat하게 해석되어 버림)  이쪽 개발하는 사람들이 프로젝트를 만들어서 뭔가 스터디를 하는 것 같은데, 개발속도는 아마 끔찍하게 느릴 것이다.  몇 년 걸릴지도 모른다.








