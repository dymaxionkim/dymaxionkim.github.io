## ElmerFEM

![ElmerFEM](https://upload.wikimedia.org/wikipedia/commons/c/c8/Elmerlogo.png)

### 소개
* https://www.csc.fi/web/elmer
* 다중물리현상(Multi-Physics)을 다루기에 적합한 유한요소해석(FEM) 소프트웨어이다.
* 핀란드 CSC 연구소에서 1995년부터 개발, 2005년부터 오픈소스화 했다.
* 페터 라박(Peter Råback) 박사를 중심으로 한 소수의 연구원들이 개발한다.  라박 박사는 이력을 보니까 학생 시절부터 이걸 개발하기 시작해서 이걸로 박사도 따고 여지껏 여기에 계속 매달리고 있다.  취미는 [직장인 밴드 보컬](http://staff.csc.fi/band/pages/pictures/Kuopio_2000_3.jpg).  대단하다는 생각이 든다.  '빨리빨리' 문화의 우리나라에서는 이런 타입의 연구자(개발자)가 존재하는 것은 아마 불가능할 것이다.  아마 이게 현재 한국의 한계일지도 모른다.
* 해석기의 핵심 라이브러리들은 Fortran 기반이다.  GUI 부분은 C++ 및 QT 가지고 만들었다.
* MPI 기반 Multi Core 연산이 가능하며 상당히 안정적이다.  때문에 병렬형 슈퍼컴퓨터(HPC)에서의 활용을 최종 타겟으로 한 것 같다.
* 실제로 주요 해석 사례들을 보면, 엄청난 개수의 매쉬로 쪼개서 반도체용 원료 실리콘 덩어리의 상변화 시뮬레이션을 한 것이 대표작이다. (이걸로 라박 박사가 박사학위 취득)  그 외에도, 그린란드 대륙 전체를 뒤덮고 있는 빙하를 모델링해서 매쉬로 쪼갠 다음에 [Full Stokes 방정식(레이놀즈 넘버가 아주 작은 경우 즉 점성 효과가 매우 큰 유체 해석)](https://en.wikipedia.org/wiki/Stokes_flow)으로 대륙 전체를 장기간에 걸쳐 해석한 사례도 있다. ([ElmerICE](http://elmerice.elmerfem.org/))
* Multi-Physics 해석이 가능하며, 이것들이 유기적으로 연결되어 구성되어 있다(모놀리딕 구조).  따라서 사용자 입장에서 간편하게 된다.
* 최근에 굉장히 업데이트가 잦다.  개발팀이 꽤 속도를 내고 있는 듯 하다.  최근에는 Mechanical Contact 쪽 부분을 주로 보완하고 있던데, 잘 발전시켰으면 좋겠다.

### 장점
* 다른 오픈소스 해석기들보다 초보자 입장에서 설치 및 사용이 굉장히 쉽고 간단하다.
* 간단한 문제는 GUI를 통해서 쉽고 신속하게 조건을 만들어 실행시킬 수 있다.
* 터미널 명령으로 옵션을 줘서 백그라운드로 실행해도 무방하다.
* Multi-Physics 문제 해결에 매우 유리하다.  구조해석, 열해석, 유체해석, 전자기장 해석 등을 섞어서 하는 것도 다 된다.
* 이걸 가지고 놀다 보면 폭넓은 물리학 학습 효과도 얻을 수 있다.
* 능력이 된다면 간결하게 Fortran Function으로 독자적인 해석기를 만들어 실행할 수도 있다.
* VTK 출력파일을 만들어낼 수 있어 결과물의 가시화(Visualization)에 유리하다.

### 단점
* 32bit 시스템에 대한 지원이 더이상 안되므로, 반드시 64bit 시스템에서만 사용할 수 있다.
* Multi-Body 해석은 불리하다.  안되는건 아닌데 모델을 만들어내기가 상당히 까다로와진다.
* 아직 Mechanical Contact 해석 부분이 상당히 약하다.  Contact 해석을 제대로 하려면 다른 해석기(Calculix,Code_Aster)를 쓰는게 나을 것이다.
* 유체해석 부분도 좀 약하다.  압축성 유체해석은 다른 해석기(OpenFOAM,Code_Saturne)를 쓰는게 나을 것이다.
* 아무래도 형상이 복잡한 경우에는 좀 불리해진다.  가급적 최대한 모델을 단순하게 해서 사용하는 것이 좋다.

### 배경지식
* 훨씬 더 전문적이고 기능도 잘 발달된 [Calculix](http://www.calculix.de/), [Code_Aster](http://www.code-aster.org/), [Code_Saturne](http://code-saturne.org/), [OpenFOAM](http://www.openfoam.com/), [SU2](http://su2.stanford.edu/) 같은 것을 사용하지 않는 이유는 간단하다.
* 어렵기 때문이다.  이런 것들은 설치하는 것 자체도 초보자에게는 심히 어렵다.
* 여러가지 검토를 꽤 오랫동안 해 봤는데, 입문 단계에서는 역시 Elmer가 짱이다.
* 입문이 쉽다고 해서 Elmer가 허접한 소프트웨어라는 것은 아니다.  다른 것들이 가지지 못한 특유의 장점들이 많다.  입출력 파일들이 이해하기 쉽도록 확실하고, 굉장히 안정적이라서 뻑날 확률도 거의 없으며, 다중물리현상을 다루는 다양한 해석기들의 구성을 보면 감탄할 정도로 간결하고 구조적으로 잘 만들어놨다.  유럽에 있는 슈퍼컴퓨터들 중에 상당수는 Elmer를 기본적으로 깔아놓고 쓴다고 한다.  아마 필요한 문제에 대한 해답의 상당부분은 Elmer만 가지고도 충분히 얻어낼 수 있을 것으로 생각된다.

### 설치 방법
* 다음 명령을 터미널에 쳐 넣으면 끝.
```bash
sudo apt-add-repository ppa:elmer-csc-ubuntu/elmer-csc-ppa
sudo apt-get update
sudo apt-get install elmerfem-csc
```



## Elmer 처음 둘러보기

### Elmer의 구성
* `ElmerGUI` : GUI로 사용할 수 있도록 QT로 만든 일종의 쉘이다.  간단한 해석은 이 안에서 모두 가능하지만, 모든 기능을 다 지원하지는 못하므로 한계가 있다.  입문단계에서 매우 유용한 듯 하다.  디자인이 매우 간소하게 되어 있어 실행 실패 확률을 크게 낮추어준다.
* `ElmerSolver` : 해석자(Solver)의 실행 명령이다.  실행할 때는 case.sif 파일에 설정된 내용을 자동으로 읽어들인 후 조건을 반영하여 해석이 실행된다.
* `ElmerGrid` : 형상모델을 만들거나, 이미 존재하는 형상모델을 ElmerSolver에서 다룰 수 있는 매쉬 포멧으로 생성해주는 기능이 있다.
* `ElmerPost` : ElmerGUI 안의 메뉴에서 기본적으로 실행된다.  해석결과를 가시화해준다.  업데이트가 중단된지 오래되었으며 기능상 한계가 있으나 간단히 결과를 확인하고자 할 때나 다른 가시화 툴이 마땅히 없을 때 유용하다.
* `ElmerVTK` : ElmerPost와 별도로 만들어진 가시화 툴이다.  역시 ElmerGUI 안의 메뉴에서 실행된다.  VTK 기반이다.  역시 기능상 한계가 있으나 간단히 결과확인 목적으로 유용하다.
* `MATC` : Elmer 안에서 수식을 연산해 줄 필요가 있을 때 사용하는 내부적인 유틸리티이다.  자칭 '가난한 자의 Matlab'이라고 한다.  예를 들어 case.sif 파일 안에서 특정 변수값을 원하는 함수로 표현하고자 할 때, MATC 표현을 사용할 수 있다.  내부적으로 MATC 실행명령을 작동시켜 연산이 이루어지는 구조다.
* `ElmerF90` : Elmer 패키지 안에 내장된 약식의 Fortran 컴파일러다.  사용자가 자신이 원하는 특정한 해석자(Solver) 함수를 만들어서 해석에 직접 적용시키고자 할 때, Fortran Function으로 소스코드를 작성한 후 이걸로 곧바로 컴파일하고 나서 해석 과정에 직접 적용할 수 있다.

### Elmer의 특성
* 기본적으로 유한요소(Finite Element) 방법론에 기초하여 해석이 이루어진다.  예외는 입자(Particle) 해석기를 사용할 경우 뿐인 듯 하다.
* 유한체적법, 유한차분법을 사용하지 않는 것 같은데 이때문에 유체해석에서 약간 불리한 듯 하다.
* 그 대신 전체 해석 구조가 간결해지고 다중물리해석을 위한 데이타의 통일성을 가지기에는 유리한 듯 하다.

### ElmerGUI
* 입문단계에서는 우선 ElmerGUI 툴을 사용하여 GUI 환경에서 작업을 실시할 수 있다.  터미널에서 `ElmerGUI`라고 치면 실행된다.
* ElmerGUI의 핵심 기능은 간단히 말해, 해석을 위한 입력파일인 case.sif 파일을 GUI를 통해 반자동으로 작성해 주는 것이다.
* 어느정도 구조가 파악되고 익숙해지면 점차 ElmerGUI를 사용하지 않고 직접 case.sif 파일을 작성해서 커맨드로 바로 실행해서 해석하는 쪽이 편하게 될 것이다.
* case.sif 파일이란, 해석을 위한 각종 조건들을 줄줄 적어준 설정파일이다.  텍스트 포멧이므로 직접 내용을 써넣어도 된다.  물론 사용되는 구문들은 매뉴얼을 보고 공부해가면서 파악해서 써야 한다.  구성이 나름 상당히 잘 정돈되어 있으므로 그렇게 어렵지는 않다.
* Elmer의 모든 기능이 ElmerGUI로 다 구현되어 있지는 않으므로, 수준을 높인 응용 해석을 위해서는 어느 시점에서부터는 case.sif 파일을 직접 편집하는 방식을 취하게 될 것이다.

### case.sif
* 사실 굳이 파일 이름이 case.sif일 필요는 없다.  다만 이름을 이걸로 고정시켜 놓고 쓰면 이것저것 신경쓸 필요없이 일관되게 작업하기가 좋은 것 같다.  매번 파일이름 짓는 것도 고역이지 않은가...


### ElmerSolver
* `ElmerSolver`라고 명령을 치면, 자동적으로 현재 디렉토리 내에서 `case.sif` 파일을 찾아서 그 내용을 반영하여 해석을 실시하게 된다.
* `ElmerSolver case001.sif` 라고 치면 현재 디렉토리 내에서 `case001.sif` 파일을 찾게 될 것이다.

### ElmerGrid
* `ElmerGird` 라고 명령을 치면, 옵션 사항에 대한 설명이 주루룩 나온다.
* `ElmerGrid 14 2 case.msh` 라고 명령을 치면, `case.msh` 파일을 찾아내고, 이것이 Gmsh의 매쉬파일 포멧이라고 인식한 후(`14`), Elmer 전용 매쉬 파일 포멧(`2`)으로 변환하게 된다.  즉 다시말해 Gmsh 파일을 Elmer 파일로 변환해 주는 것이다.
* ElmerGrid를 위한 전용 형상 정의 포멧은 `*.grd`인데, 물론 텍스트 포멧이고 그 문법은 매뉴얼을 참고하여 사용자가 직접 구성할 수 있다.
* ElmerGrid가 만들어내는 Elmer 전용 매쉬 파일 포멧은 `mesh.boundary`, `mesh.elements`, `mesh.header`, `mesh.nodes`의 4개 파일이다.  하나의 형상을 정의하기 위해 왜 4개의 파일로 굳이 쪼개는 특수한 형태를 취했는지에 대해서 정확한 이유는 모르겠으나, 각 요소별로 정보를 나누다 보니까 아무래도 각 파일의 사이즈가 줄어들고 내부적으로 이리저리 다루기가 수월해서 그런 것 아닐까 추측된다.

### ElmerPost
* `ElmerGUI`의 메뉴 중에서 `Run > Start ElmerPost`를 선택하면 실행된다.  해석된 결과를 보여주며, 사용방법은 상당히 괴이하지만 가만히 들여다보면 대충 파악된다.


### ElmerVTK
* ElmerPost 보다는 좀 예뻐 보이지만 기능적으로 보면 좀 부족하다.  예를 들어 스트레스를 받아 변형된 형상을 보여주거나 하지는 못한다.  유체 해석 결과의 유선(Stream Line)을 보여주는 기능도 잘 안될 확률이 높다.
* `ElmerGUI`의 메뉴 중에서 `Run > Start ElmerVTK`를 선택하면 실행된다.  해석된 결과를 보여주며, 사용방법은 매우 직관적이므로 별다른 설명이 필요없다.

### ParaView
* ElmerPost, ElmerVTK 말고 외부 가시화 툴로 ParaView를 ElmerGUI 상에서 직접 실행시킬 수 있도록 메뉴가 추가되어 있다.
* `ElmerGUI`의 멘 중에서 `Run > Start ParaView`를 선택하면 ParaView가 자동으로 실행되면서 해석된 결과를 보여줄 수 있게 된다.
* 단, 이때 ParaView는 반드시 시스템에 설치되어 있어야만 실행이 이루어진다.


## ElmerGUI의 EDF 확장
```
sudo cp /usr/share/ElmerGUI/edf-extra/*.xml /usr/share/ElmerGUI/edf/
```

